{
  "name": "A/H Stock Intelligent Analysis System",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "weeks",
              "triggerAtDay": [
                1,
                2,
                3,
                4,
                5
              ],
              "triggerAtHour": 18
            }
          ]
        }
      },
      "id": "099a7e9a-e129-445b-835e-b41b36e7824c",
      "name": "å®šæ—¶è§¦å‘_å·¥ä½œæ—¥18ç‚¹",
      "type": "n8n-nodes-base.scheduleTrigger",
      "position": [
        -3648,
        288
      ],
      "typeVersion": 1.1
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "https://docs.google.com/spreadsheets/d/1_MqQPC5DzLTarOM4hJ9_ajUX20piCiD6YmeM6Cp5Iys/edit?gid=0#gid=0",
          "mode": "url"
        },
        "sheetName": {
          "__rl": true,
          "value": "stock list",
          "mode": "name"
        },
        "options": {}
      },
      "id": "f962e3a6-1c20-43c3-b991-111562559e58",
      "name": "è¯»å–è‚¡ç¥¨åˆ—è¡¨",
      "type": "n8n-nodes-base.googleSheets",
      "position": [
        -3440,
        288
      ],
      "typeVersion": 4.7,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "OKN7AHfMulimnqoc",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "id": "95e63b60-10da-4cfa-abb5-3a2a7240c879",
      "name": "å¾ªç¯å¤„ç†æ¯åªè‚¡ç¥¨",
      "type": "n8n-nodes-base.splitInBatches",
      "position": [
        -3216,
        288
      ],
      "typeVersion": 3
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "condition-market",
              "leftValue": "={{ $json.market }}",
              "rightValue": "A",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "22b4d7ef-25b6-4fbe-bd7d-b21e6b313e70",
      "name": "åˆ¤æ–­å¸‚åœºç±»å‹",
      "type": "n8n-nodes-base.if",
      "position": [
        -3008,
        304
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "url": "=https://qt.gtimg.cn/q={{ $json.market === 'A' ? ($json.code.toString().startsWith('6') ? 'sh' : 'sz') : 'hk' }}{{ $json.code }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Referer",
              "value": "https://finance.qq.com/"
            }
          ]
        },
        "options": {
          "timeout": 30000
        }
      },
      "id": "c216228d-c045-423b-acbb-8b62d9897024",
      "name": "è…¾è®¯è´¢ç»_å®æ—¶è¡Œæƒ…",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -2816,
        288
      ],
      "typeVersion": 4.3,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "url": "=https://query1.finance.yahoo.com/v8/finance/chart/{{ $json.code.toString().replace(/^0+/, '') }}.HK?interval=1d&range=60d",
        "options": {
          "timeout": 30000
        }
      },
      "id": "8e7a24ed-0170-41ca-a66e-9877b4c6659c",
      "name": "YahooFinance_æ¸¯è‚¡æ•°æ®",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -2816,
        496
      ],
      "typeVersion": 4.3,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// è§£æè…¾è®¯è´¢ç»å®æ—¶è¡Œæƒ…æ•°æ®\nconst rawData = $json.data;\n\n// ã€å…³é”®ä¿®æ”¹ã€‘ä»â€œåˆ¤æ–­å¸‚åœºç±»å‹â€èŠ‚ç‚¹è·å–åŸå§‹ä¿¡æ¯ï¼Œå¹¶å¼ºåˆ¶è½¬ä¸ºå­—ç¬¦ä¸²é˜²æ­¢æŠ¥é”™\nconst code = $('åˆ¤æ–­å¸‚åœºç±»å‹').item.json.code.toString();\nconst market = $('åˆ¤æ–­å¸‚åœºç±»å‹').item.json.market;\n\n// è…¾è®¯è¿”å›æ ¼å¼: v_sh600519=\"1~è´µå·èŒ…å°~600519~1785.00~1790.00~...\"\n// æ ¹æ® code å’Œ market åŠ¨æ€ç”Ÿæˆå˜é‡å\nconst varName = market === 'A' ? `v_${code.startsWith('6') ? 'sh' : 'sz'}${code}` : `v_hk${code}`;\n\n// ä½¿ç”¨æ­£åˆ™æå–å¼•å·å†…çš„å†…å®¹\nconst regex = new RegExp(`${varName}=\\\"([^\\\"]+)\\\"`);\nconst match = rawData.match(regex);\n\nif (!match) {\n  return [{ json: { error: \"æ— æ³•è§£æè…¾è®¯è´¢ç»æ•°æ®\", raw: rawData.substring(0, 200) } }];\n}\n\nconst fields = match[1].split('~');\n\n// å­—æ®µæ˜ å°„ï¼ˆè…¾è®¯è´¢ç»æ ¼å¼ï¼‰\nconst stockData = {\n  code: code,\n  market: market,\n  name: fields[1] || `${market === 'A' ? 'è‚¡ç¥¨' : 'æ¸¯è‚¡'}${code}`,\n  current_price: parseFloat(fields[3]) || 0,\n  yesterday_close: parseFloat(fields[4]) || 0,\n  open: parseFloat(fields[5]) || 0,\n  high: parseFloat(fields[6]) || 0,\n  low: parseFloat(fields[7]) || 0,\n  volume: parseInt(fields[8]) * 100 || 0, // æ‰‹è½¬è‚¡\n  turnover_rate: parseFloat(fields[9]) || 0, // æ¢æ‰‹ç‡\n  volume_ratio: parseFloat(fields[10]) || 1, // é‡æ¯”\n  pe_ratio: parseFloat(fields[11]) || 0, // å¸‚ç›ˆç‡\n  pb_ratio: parseFloat(fields[12]) || 0, // å¸‚å‡€ç‡\n  market_cap: (parseFloat(fields[13]) || 0) * 100000000, // æ€»å¸‚å€¼\n  change_amount: parseFloat(fields[14]) || 0, // æ¶¨è·Œé¢\n  change_percent: parseFloat(fields[15]) || 0, // æ¶¨è·Œå¹…\n  amplitude: parseFloat(fields[16]) || 0, // æŒ¯å¹…\n  data_source: 'è…¾è®¯è´¢ç»'\n};\n\nreturn [{ json: stockData }];"
      },
      "id": "86bc65c8-a29f-408e-85fa-8e2af19c7789",
      "name": "è§£æè…¾è®¯æ•°æ®",
      "type": "n8n-nodes-base.code",
      "position": [
        -2608,
        288
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// ã€ä¿®å¤ç‰ˆã€‘è§£æYahooæ•°æ® - å¼ºåˆ¶æ‰¾å›è‚¡ç¥¨ä»£ç \n\n// 1. å…³é”®ä¿®å¤ï¼šä»æºå¤´èŠ‚ç‚¹æ‰¾å›ä¸¢å¤±çš„è‚¡ç¥¨ä»£ç \n// YahooèŠ‚ç‚¹æ‰§è¡Œå®Œåä¼šæŠŠè¾“å…¥è¦†ç›–ï¼Œ$json.code ä¼šæ¶ˆå¤±ï¼Œæ‰€ä»¥å¿…é¡»å»ä¸Šæ¸¸æ‹¿\nlet code;\ntry {\n  // è¿™é‡Œçš„ä¸­æ–‡åç§°å¿…é¡»å’Œä½ ç”»å¸ƒä¸Šçš„èŠ‚ç‚¹åç§°å®Œå…¨ä¸€è‡´\n  code = $('åˆ¤æ–­å¸‚åœºç±»å‹').item.json.code.toString();\n} catch (e) {\n  // å®¹é”™ï¼šå¦‚æœä¸Šæ¸¸æ‹¿ä¸åˆ°ï¼Œå°è¯•ä»å½“å‰èŠ‚ç‚¹æ‹¿\n  code = $json.code ? $json.code.toString() : \"00000\";\n}\n\n// 2. æ£€æŸ¥ Yahoo æ•°æ®æœ‰æ•ˆæ€§\nconst chart = $json.chart;\nif (!chart || !chart.result || chart.result.length === 0) {\n  const error = chart?.error?.description || \"æ— æ³•è·å–Yahooæ•°æ®\";\n  // å³ä½¿æŠ¥é”™ï¼Œä¹Ÿè¦æŠŠ code ä¼ ä¸‹å»ï¼Œé˜²æ­¢æµç¨‹ä¸­æ–­\n  return [{ json: { error: error, code: code, market: 'HK' } }];\n}\n\nconst result = chart.result[0];\nconst meta = result.meta;\nconst timestamps = result.timestamp || [];\nconst quotes = result.indicators?.quote?.[0] || {};\n\n// 3. è·å–æœ€æ–°æ•°æ®\nconst lastIdx = timestamps.length - 1;\nconst currentPrice = meta.regularMarketPrice || quotes.close?.[lastIdx] || 0;\nconst previousClose = meta.previousClose || meta.chartPreviousClose || 0;\n\n// è®¡ç®—æ¶¨è·Œå¹…\nconst changePercent = previousClose > 0 \n  ? ((currentPrice - previousClose) / previousClose * 100).toFixed(2)\n  : 0;\n\n// 4. æå–OHLCæ•°æ®\nconst ohlcData = [];\nfor (let i = 0; i < timestamps.length; i++) {\n  if (quotes.close?.[i]) {\n    ohlcData.push({\n      date: new Date(timestamps[i] * 1000).toISOString().split('T')[0],\n      open: quotes.open?.[i] || 0,\n      high: quotes.high?.[i] || 0,\n      low: quotes.low?.[i] || 0,\n      close: quotes.close?.[i] || 0,\n      volume: quotes.volume?.[i] || 0\n    });\n  }\n}\n\n// 5. ç»„è£…æœ€ç»ˆæ•°æ®\nconst stockData = {\n  code: code, // ã€å…³é”®ä¿®å¤ç‚¹ã€‘ä½¿ç”¨æ‰¾å›æ¥çš„ code\n  market: 'HK',\n  name: meta.shortName || meta.longName || `æ¸¯è‚¡${code}`,\n  current_price: currentPrice,\n  yesterday_close: previousClose,\n  open: meta.regularMarketOpen || quotes.open?.[lastIdx] || 0,\n  high: meta.regularMarketDayHigh || quotes.high?.[lastIdx] || 0,\n  low: meta.regularMarketDayLow || quotes.low?.[lastIdx] || 0,\n  volume: meta.regularMarketVolume || quotes.volume?.[lastIdx] || 0,\n  change_percent: parseFloat(changePercent),\n  currency: meta.currency || 'HKD',\n  ohlc_data: ohlcData.slice(-60),\n  data_source: 'Yahoo Finance'\n};\n\nreturn [{ json: stockData }];"
      },
      "id": "f3461664-74aa-467c-8a5b-47e50af492ea",
      "name": "è§£æYahooæ•°æ®",
      "type": "n8n-nodes-base.code",
      "position": [
        -2608,
        496
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "url": "=http://web.ifzq.gtimg.cn/appstock/app/fqkline/get?param={{ $json.code.startsWith('6') ? 'sh' : 'sz' }}{{ $json.code }},day,,,60,qfq",
        "options": {
          "timeout": 30000
        }
      },
      "id": "b5a9428f-c50f-499d-9386-281b8bf45fd8",
      "name": "è…¾è®¯è´¢ç»_Kçº¿æ•°æ®",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -2384,
        288
      ],
      "typeVersion": 4.3
    },
    {
      "parameters": {
        "jsCode": "// ã€èµ„æ·±æ“ç›˜æ‰‹ç‰ˆã€‘è®¡ç®—Aè‚¡æŠ€æœ¯æŒ‡æ ‡ - V5.0 (å¼•å…¥ATRä¸EMA)\n\n// 1. æ•°æ®è·å–ä¸é˜²å¾¡é€»è¾‘\nlet code;\ntry {\n  code = $('åˆ¤æ–­å¸‚åœºç±»å‹').item.json.code.toString();\n} catch (e) {\n  code = $json.code ? $json.code.toString() : \"\"; \n}\nif (!code) return [{ json: { error: \"æ— æ³•æ‰¾åˆ°è‚¡ç¥¨ä»£ç \" } }];\n\nlet apiResponse = $json.data; \nif (typeof apiResponse === 'string') {\n  try { apiResponse = JSON.parse(apiResponse); } catch(e) {}\n}\nconst stockMap = apiResponse.data || apiResponse; \nconst marketPrefix = code.startsWith('6') ? 'sh' : 'sz';\nconst key = `${marketPrefix}${code}`;\nconst stockData = stockMap[key];\n\nif (!stockData || !stockData.qfqday) {\n  return [{ json: { error: `æœªæ‰¾åˆ°Kçº¿æ•°æ®`, code: code } }];\n}\n\nconst klines = stockData.qfqday; \n// æå–æ•°æ®åˆ— (è…¾è®¯æ¥å£: 0æ—¥æœŸ, 1å¼€, 2æ”¶, 3é«˜, 4ä½, 5é‡)\nconst closes = klines.map(k => parseFloat(k[2]));\nconst highs = klines.map(k => parseFloat(k[3]));\nconst lows = klines.map(k => parseFloat(k[4]));\nconst volumes = klines.map(k => parseFloat(k[5]));\n\n// --- ğŸ› ï¸ æ ¸å¿ƒç®—æ³•å‡çº§åŒºåŸŸ ---\n\n// 1. åŸºç¡€ MA è®¡ç®—\nfunction calculateMA(data, period) {\n  if (data.length < period) return 0;\n  const sum = data.slice(-period).reduce((a, b) => a + b, 0);\n  return sum / period;\n}\n\n// 2. â­ æ–°å¢ï¼šEMA è®¡ç®— (å¯¹è¿‘æœŸä»·æ ¼æ›´æ•æ„Ÿ)\nfunction calculateEMA(data, period) {\n  if (data.length < period) return data[data.length - 1];\n  const k = 2 / (period + 1);\n  let ema = data[0];\n  for (let i = 1; i < data.length; i++) {\n    ema = data[i] * k + ema * (1 - k);\n  }\n  return ema;\n}\n\n// 3. â­ æ–°å¢ï¼šATR è®¡ç®— (çœŸå®æ³¢å¹…ï¼Œç”¨äºåŠ¨æ€æ­¢æŸ)\nfunction calculateATR(highs, lows, closes, period) {\n  if (highs.length < period + 1) return 0;\n  let trs = [];\n  for(let i=1; i<highs.length; i++) {\n    const hl = highs[i] - lows[i];\n    const hc = Math.abs(highs[i] - closes[i-1]);\n    const lc = Math.abs(lows[i] - closes[i-1]);\n    trs.push(Math.max(hl, hc, lc));\n  }\n  // ç®€å•ç§»åŠ¨å¹³å‡è®¡ç®— ATR\n  if (trs.length < period) return 0;\n  return trs.slice(-period).reduce((a,b)=>a+b,0) / period;\n}\n\n// 4. RSI è®¡ç®—\nfunction calculateRSI(closes, period) {\n  if (closes.length < period + 1) return 50;\n  let gains = 0, losses = 0;\n  for (let i = closes.length - period; i < closes.length; i++) {\n    const change = closes[i] - closes[i-1];\n    if (change > 0) gains += change;\n    else losses -= change;\n  }\n  const avgGain = gains / period;\n  const avgLoss = losses / period;\n  if (avgLoss === 0) return 100;\n  return Math.round(100 - (100 / (1 + avgGain / avgLoss)));\n}\n\n// --- æŒ‡æ ‡è®¡ç®—æ‰§è¡Œ ---\n\nconst currentPrice = closes[closes.length - 1];\nconst ma5 = calculateMA(closes, 5);\nconst ma10 = calculateMA(closes, 10);\nconst ma20 = calculateMA(closes, 20);\nconst ma60 = calculateMA(closes, 60);\n\n// â­ è®¡ç®— EMA (EMA13 æ˜¯ç»å…¸çš„æ“ç›˜çº¿)\nconst ema13 = calculateEMA(closes, 13);\nconst ema26 = calculateEMA(closes, 26); // ç›¸å½“äº MACD çš„æ…¢çº¿\n\n// â­ è®¡ç®— ATR (14å‘¨æœŸ)\nconst atr14 = calculateATR(highs, lows, closes, 14);\n\n// ä¹–ç¦»ç‡ (ä½¿ç”¨ EMA13 æ›´å‡†ï¼Œä½†ä¸ºäº†å…¼å®¹æ€§ä¿ç•™ MA5)\nconst biasMA5 = ma5 > 0 ? ((currentPrice - ma5) / ma5 * 100).toFixed(2) : 0;\nconst rsi14 = calculateRSI(closes, 14);\n\n// é‡æ¯” & èµ„é‡‘æµå‘åˆç­›\nconst avgVolume5 = calculateMA(volumes.slice(0, -1), 5);\nconst currentVolume = volumes[volumes.length - 1];\nconst volumeRatio = avgVolume5 > 0 ? (currentVolume / avgVolume5).toFixed(2) : 1.0;\n// åˆ¤å®šæ˜¯å¦æ”¾é‡é˜³çº¿\nconst isBullishVolume = (currentPrice > closes[closes.length-2]) && (currentVolume > avgVolume5 * 1.2);\n\n// --- ğŸ¤– æ™ºèƒ½ä¿¡å·ç”Ÿæˆé€»è¾‘ (å‡çº§ç‰ˆ) ---\n\nlet signal = \"è§‚æœ› âšª\";\nlet signalReasons = [];\nlet riskFactors = [];\nlet trendScore = 50;\n\n// 1. è¶‹åŠ¿è¯„åˆ† (å¼•å…¥ EMA æƒé‡)\nif (ema13 > ema26) trendScore += 20; // ä¸­æœŸè¶‹åŠ¿å‘ä¸Š\nif (currentPrice > ma60) trendScore += 20; // é•¿æœŸè¶‹åŠ¿å‘ä¸Š\nif (ma5 > ma10 && ma10 > ma20) trendScore += 20; // å‡çº¿å®Œç¾æ’åˆ—\nif (rsi14 > 50 && rsi14 < 70) trendScore += 10; // åŠ¨èƒ½å……æ²›ä¸”æœªè¶…ä¹°\n\n// 2. ä¹°å…¥ä¿¡å·åˆ¤å®š\nconst isConsolidating = Math.abs(ma5 - ma20) / ma20 < 0.05; // å‡çº¿ç²˜åˆ\nconst isBreakout = currentPrice > ma5 && currentPrice > ma20; // çªç ´å‡çº¿\n\n// ç­–ç•¥ A: å‡çº¿å¤šå¤´æ’åˆ— + ç¼©é‡å›è¸© (æœ€ä½³ä¹°ç‚¹)\nif (ma5 > ma10 && ma10 > ma20 && currentPrice > ma20) {\n    if (parseFloat(biasMA5) < 3 && parseFloat(biasMA5) > -2) {\n        signal = \"ä¹°å…¥ ğŸŸ¢\";\n        signalReasons.push(\"å¤šå¤´è¶‹åŠ¿ä¸­çš„å¥åº·å›è¸©(ä¹–ç¦»ç‡ä½)\");\n    } else if (parseFloat(biasMA5) >= 5) {\n        riskFactors.push(\"å¤šå¤´è¶‹åŠ¿ä½†çŸ­æœŸè¶…ä¹°(ä¹–ç¦»ç‡>5%)ï¼Œå‹¿è¿½é«˜\");\n    }\n}\n\n// ç­–ç•¥ B: åº•éƒ¨å‡çº¿ç²˜åˆåæ”¾é‡çªç ´ (èµ·çˆ†ç‚¹)\nif (isConsolidating && isBreakout && isBullishVolume) {\n    signal = \"å¼ºçƒˆä¹°å…¥ ğŸš€\";\n    signalReasons.push(\"å‡çº¿ç²˜åˆåæ”¾é‡çªç ´ï¼Œä¸»åŠ›å¯åŠ¨è¿¹è±¡\");\n    trendScore += 15;\n}\n\n// 3. é£é™©é¢„è­¦\nif (currentPrice < ma20 && ma5 < ma20) {\n    signal = \"å–å‡º ğŸ”´\";\n    riskFactors.push(\"è·Œç ´MA20ç”Ÿå‘½çº¿ï¼Œè¶‹åŠ¿è½¬å¼±\");\n}\nif (rsi14 > 80) riskFactors.push(\"RSIä¸¥é‡è¶…ä¹°ï¼Œéšæ—¶å›è°ƒ\");\n\n// --- ğŸ’° åŠ¨æ€æ­¢ç›ˆæ­¢æŸè®¡ç®— (ATRæˆ˜æ³•) ---\n\n// æ­¢æŸï¼šå¤šå¤´è¶‹åŠ¿ä¸‹ï¼Œä½¿ç”¨ 2å€ ATR ä½œä¸ºå®‰å…¨å«\n// å¦‚æœ ATR å¾ˆå°(æ³¢åŠ¨å°)ï¼Œæ­¢æŸå°±ç´§ï¼›ATR å¤§ï¼Œæ­¢æŸå°±æ¾\nconst stopLossLevel = (currentPrice - 2.0 * atr14).toFixed(2);\n\n// ç›®æ ‡ï¼šè‡³å°‘ 1.5å€ çš„ç›ˆäºæ¯”\nconst riskPerShare = currentPrice - stopLossLevel;\nconst takeProfitLevel = (currentPrice + 1.5 * riskPerShare).toFixed(2);\n\n// æ”¯æ’‘å‹åŠ› (ä¿ç•™ä¼ ç»Ÿç®—æ³•ä½œä¸ºè¾…åŠ©)\nconst supportLevel = Math.max(ma20, parseFloat(stopLossLevel)).toFixed(2);\nconst resistanceLevel = Math.max(...highs.slice(-20)).toFixed(2);\n\n// è·å–è‚¡ç¥¨åç§°\nconst stockName = $('åˆ¤æ–­å¸‚åœºç±»å‹').item.json.name || code;\n\nreturn [{\n  json: {\n    code: code,\n    market: 'A',\n    name: stockName,\n    current_price: currentPrice.toFixed(2),\n    ma5: ma5.toFixed(2),\n    ma10: ma10.toFixed(2),\n    ma20: ma20.toFixed(2),\n    ma60: ma60.toFixed(2),\n    bias_ma5: parseFloat(biasMA5),\n    rsi14: rsi14,\n    volume_ratio: parseFloat(volumeRatio),\n    atr14: parseFloat(atr14.toFixed(2)), // è¾“å‡ºATRä¾›AIå‚è€ƒ\n    ma_alignment: ema13 > ema26 ? \"è¶‹åŠ¿å‘ä¸Š ğŸ“ˆ\" : \"è¶‹åŠ¿å‘ä¸‹ ğŸ“‰\",\n    trend_score: trendScore,\n    signal: signal,\n    signal_reasons: signalReasons,\\n    risk_factors: riskFactors,\n    support_level: parseFloat(supportLevel),\n    resistance_level: parseFloat(resistanceLevel),\n    stop_loss: parseFloat(stopLossLevel), // ä½¿ç”¨åŠ¨æ€æ­¢æŸ\n    take_profit: parseFloat(takeProfitLevel), // ä½¿ç”¨åŠ¨æ€æ­¢ç›ˆ\n    data_source: 'è…¾è®¯è´¢ç»',\n    currency: 'CNY'\n  }\n}];"
      },
      "id": "2a58869b-1818-4f9f-bcb8-f7ba6785f243",
      "name": "è®¡ç®—Aè‚¡æŠ€æœ¯æŒ‡æ ‡",
      "type": "n8n-nodes-base.code",
      "position": [
        -2208,
        288
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// ã€å…¨é€‰æ›¿æ¢ã€‘è®¡ç®—æ¸¯è‚¡æŠ€æœ¯æŒ‡æ ‡ - æ™ºèƒ½é˜²é”™ç‰ˆ V2\n\n// 1. ã€é—¨ç¦ã€‘å¦‚æœæ˜¯Aè‚¡æ•°æ®è¯¯å…¥ï¼Œç›´æ¥è·³è¿‡ï¼Œåœæ­¢æ‰§è¡Œ\n// è¿™æ ·å°±ä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿä¸ä¼šè¾“å‡ºé”™è¯¯æ•°æ®å¹²æ‰°åˆå¹¶\nif ($json.market !== 'HK') {\n  return []; \n}\n\n// 2. è·å–Yahooæ•°æ®\nconst ohlcData = $json.ohlc_data || [];\n\nif (ohlcData.length === 0) {\n  return [{ json: { error: \"æ— OHLCæ•°æ® (å¯èƒ½Yahooæœªè¿”å›)\", code: $json.code } }];\n}\n\n// 3. æå–æ•°æ®\nconst closes = ohlcData.map(d => d.close);\nconst volumes = ohlcData.map(d => d.volume);\nconst highs = ohlcData.map(d => d.high);\nconst lows = ohlcData.map(d => d.low);\n\n// è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—ç§»åŠ¨å¹³å‡\nfunction calculateMA(data, period) {\n  if (data.length < period) return 0;\n  const sum = data.slice(-period).reduce((a, b) => a + b, 0);\n  return sum / period;\n}\n\n// è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—RSI\nfunction calculateRSI(closes, period) {\n  if (closes.length < period + 1) return 50;\n  let gains = 0, losses = 0;\n  for (let i = closes.length - period; i < closes.length; i++) {\n    const change = closes[i] - closes[i-1];\n    if (change > 0) gains += change;\n    else losses -= change;\n  }\n  const avgGain = gains / period;\n  const avgLoss = losses / period;\n  if (avgLoss === 0) return 100;\n  const rs = avgGain / avgLoss;\n  return Math.round(100 - (100 / (1 + rs)));\n}\n\n// è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—ATR\nfunction calculateATR(highs, lows, closes, period) {\n  if (highs.length < period + 1) return 0;\n  let trs = [];\n  for(let i=1; i<highs.length; i++) {\n    const hl = highs[i] - lows[i];\n    const hc = Math.abs(highs[i] - closes[i-1]);\n    const lc = Math.abs(lows[i] - closes[i-1]);\n    trs.push(Math.max(hl, hc, lc));\n  }\n  if (trs.length < period) return 0;\n  return trs.slice(-period).reduce((a,b)=>a+b,0) / period;\n}\n\n// è¾…åŠ©å‡½æ•°ï¼šè®¡ç®—è¶‹åŠ¿è¯„åˆ†\nfunction calculateTrendScore(price, ma5, ma10, ma20, bias, rsi) {\n  let score = 50;\n  if (ma5 > ma10 && ma10 > ma20) score += 20;\n  if (price > ma5) score += 10;\n  if (Math.abs(bias) < 3) score += 10;\n  if (rsi > 40 && rsi < 70) score += 10;\n  return Math.min(100, Math.max(0, score));\n}\n\n// è®¡ç®—æŒ‡æ ‡\nconst ma5 = calculateMA(closes, 5);\nconst ma10 = calculateMA(closes, 10);\nconst ma20 = calculateMA(closes, 20);\nconst ma60 = calculateMA(closes, Math.min(60, closes.length));\n\nconst currentPrice = closes[closes.length - 1];\n\n// è®¡ç®—ATR (14å‘¨æœŸ)\nconst atr14 = calculateATR(highs, lows, closes, 14);\n\n// è®¡ç®—ä¹–ç¦»ç‡\nconst biasMA5 = ma5 > 0 ? ((currentPrice - ma5) / ma5 * 100).toFixed(2) : 0;\n\nconst rsi14 = calculateRSI(closes, 14);\n\n// è®¡ç®—é‡æ¯” (ç®€å•ä¼°ç®—)\nconst avgVolume5 = calculateMA(volumes.slice(0, -1), 5);\nconst currentVolume = volumes[volumes.length - 1];\nconst volumeRatio = avgVolume5 > 0 ? (currentVolume / avgVolume5).toFixed(2) : 1.0;\n\n// å‡çº¿å½¢æ€\nlet maAlignment = \"éœ‡è¡æ•´ç† â†”ï¸\";\nlet trendStrength = 50;\nif (ma5 > ma10 && ma10 > ma20) {\n  maAlignment = \"å¤šå¤´æ’åˆ— ğŸ“ˆ\";\n  trendStrength = 70;\n} else if (ma5 < ma10 && ma10 < ma20) {\n  maAlignment = \"ç©ºå¤´æ’åˆ— ğŸ“‰\";\n  trendStrength = 30;\n}\n\n// æ”¯æ’‘å‹åŠ›\nconst supportLevel = (ma20 * 0.98).toFixed(2);\nconst resistanceLevel = Math.max(...highs.slice(-20)).toFixed(2);\n\n// ä¿¡å·ç”Ÿæˆ\nlet signal = \"è§‚æœ› âšª\";\nlet signalReasons = [];\nlet riskFactors = [];\n\nif (parseFloat(biasMA5) < 5 && ma5 > ma10 && ma10 > ma20) {\n  signal = parseFloat(biasMA5) < 2 ? \"å¼ºçƒˆä¹°å…¥ ğŸŸ¢\" : \"ä¹°å…¥ ğŸŸ¢\";\n  signalReasons.push(\"ä¹–ç¦»ç‡å®‰å…¨ï¼Œå¤šå¤´æ’åˆ—\");\n} else {\n  if (parseFloat(biasMA5) >= 5) riskFactors.push(\"ä¹–ç¦»ç‡è¿‡é«˜\");\n  if (ma5 < ma10) riskFactors.push(\"çŸ­æœŸèµ°å¼±\");\n}\n\nconst trendScore = calculateTrendScore(currentPrice, ma5, ma10, ma20, parseFloat(biasMA5), rsi14);\n\nreturn [{\n  json: {\n    code: $json.code,\n    market: 'HK',\n    name: $json.name || `æ¸¯è‚¡${$json.code}`,\n    current_price: currentPrice.toFixed(2),\n    ma5: ma5.toFixed(2),\n    ma10: ma10.toFixed(2),\n    ma20: ma20.toFixed(2),\n    ma60: ma60.toFixed(2),\n    bias_ma5: biasMA5,\n    atr14: parseFloat(atr14.toFixed(2)),\n    rsi14: rsi14,\n    volume_ratio: volumeRatio,\n    ma_alignment: maAlignment,\n    trend_score: trendScore,\n    signal: signal,\n    signal_reasons: signalReasons,\n    risk_factors: riskFactors,\n    support_level: supportLevel,\n    resistance_level: resistanceLevel,\n    stop_loss: supportLevel,\n    take_profit: resistanceLevel,\n    data_source: 'Yahoo Finance',\n    currency: $json.currency || 'HKD'\n  }\n}];"
      },
      "id": "ecaee28f-6833-44ec-b90c-1cb59ef3bfb8",
      "name": "è®¡ç®—æ¸¯è‚¡æŠ€æœ¯æŒ‡æ ‡",
      "type": "n8n-nodes-base.code",
      "position": [
        -2384,
        496
      ],
      "typeVersion": 2
    },
    {
      "parameters": {},
      "id": "0a14a0c3-37d3-4920-9718-72cb75ca4f96",
      "name": "åˆå¹¶æŠ€æœ¯æŒ‡æ ‡",
      "type": "n8n-nodes-base.merge",
      "position": [
        -2000,
        304
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.tavily.com/search",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "api_key",
              "value": "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"
            },
            {
              "name": "query",
              "value": "={{ $json.name }} æœ€æ–°æ–°é—» åˆ©å¥½ åˆ©ç©º"
            },
            {
              "name": "include_answer",
              "value": "basic"
            }
          ]
        },
        "options": {
          "timeout": 15000
        }
      },
      "id": "72ff9a77-2348-4165-9711-543e28b43adb",
      "name": "Tavilyæ–°é—»æœç´¢",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        -1808,
        304
      ],
      "typeVersion": 4.3,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.prompt }}",
        "options": {
          "systemMessage": "=ä½ æ˜¯ä¸€ä½ä¸“æ³¨äºè¶‹åŠ¿äº¤æ˜“çš„Aè‚¡/æ¸¯è‚¡æŠ•èµ„åˆ†æå¸ˆï¼Œè´Ÿè´£ç”Ÿæˆä¸“ä¸šçš„ã€å†³ç­–ä»ªè¡¨ç›˜ã€‘åˆ†ææŠ¥å‘Šã€‚\n\n## æ ¸å¿ƒäº¤æ˜“ç†å¿µï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆï¼‰\n\n### 1. ä¸¥è¿›ç­–ç•¥ï¼ˆä¸è¿½é«˜ï¼‰\n- **ç»å¯¹ä¸è¿½é«˜**ï¼šå½“è‚¡ä»·åç¦»MA5è¶…è¿‡5%æ—¶ï¼Œåšå†³ä¸ä¹°å…¥\n- **ä¹–ç¦»ç‡å…¬å¼**ï¼š(ç°ä»· - MA5) / MA5 Ã— 100%\n- ä¹–ç¦»ç‡ < 2%ï¼šæœ€ä½³ä¹°ç‚¹åŒºé—´\n- ä¹–ç¦»ç‡ 2-5%ï¼šå¯å°ä»“ä»‹å…¥\n- ä¹–ç¦»ç‡ > 5%ï¼šä¸¥ç¦è¿½é«˜ï¼ç›´æ¥åˆ¤å®šä¸º\"è§‚æœ›\"\n\n### 2. è¶‹åŠ¿äº¤æ˜“ï¼ˆé¡ºåŠ¿è€Œä¸ºï¼‰\n- **å¤šå¤´æ’åˆ—å¿…é¡»æ¡ä»¶**ï¼šMA5 > MA10 > MA20\n- åªåšå¤šå¤´æ’åˆ—çš„è‚¡ç¥¨ï¼Œç©ºå¤´æ’åˆ—åšå†³ä¸ç¢°\n- è¶‹åŠ¿å¼ºåº¦åˆ¤æ–­ï¼šçœ‹å‡çº¿é—´è·æ˜¯å¦åœ¨æ‰©å¤§\n\n### 3. æ•ˆç‡ä¼˜å…ˆï¼ˆé‡èƒ½é…åˆï¼‰\n- é‡æ¯” > 1.2ï¼šæ”¾é‡ï¼Œéœ€ç»“åˆä»·æ ¼åˆ¤æ–­\n- é‡æ¯” 0.8-1.2ï¼šæ­£å¸¸\n- é‡æ¯” < 0.8ï¼šç¼©é‡ï¼Œéœ€è­¦æƒ•\n\n## è¾“å‡ºæ ¼å¼ï¼šå†³ç­–ä»ªè¡¨ç›˜ JSON\n\nè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºåˆ†æç»“æœï¼š\n\n```json\n{\n  \"stock_name\": \"è‚¡ç¥¨ä¸­æ–‡åç§°\",\n  \"sentiment_score\": 0-100æ•´æ•°,\n  \"trend_prediction\": \"å¼ºçƒˆçœ‹å¤š/çœ‹å¤š/éœ‡è¡/çœ‹ç©º/å¼ºçƒˆçœ‹ç©º\",\n  \"operation_advice\": \"ä¹°å…¥/åŠ ä»“/æŒæœ‰/å‡ä»“/å–å‡º/è§‚æœ›\",\n  \"decision_type\": \"buy/hold/sell\",\n  \"confidence_level\": \"é«˜/ä¸­/ä½\",\n  \"analysis_summary\": \"ä¸€å¥è¯æ ¸å¿ƒç»“è®º\",\n  \"dashboard\": {\n    \"core_conclusion\": {\n      \"one_sentence\": \"ä¸€å¥è¯æ ¸å¿ƒç»“è®ºï¼ˆ30å­—ä»¥å†…ï¼Œç›´æ¥å‘Šè¯‰ç”¨æˆ·åšä»€ä¹ˆï¼‰\",\n      \"signal_type\": \"ğŸŸ¢ä¹°å…¥ä¿¡å·/ğŸŸ¡æŒæœ‰è§‚æœ›/ğŸ”´å–å‡ºä¿¡å·/âš ï¸é£é™©è­¦å‘Š\",\n      \"time_sensitivity\": \"ç«‹å³è¡ŒåŠ¨/ä»Šæ—¥å†…/æœ¬å‘¨å†…/ä¸æ€¥\",\n      \"position_advice\": {\n        \"no_position\": \"ç©ºä»“è€…å»ºè®®ï¼šå…·ä½“æ“ä½œæŒ‡å¼•\",\n        \"has_position\": \"æŒä»“è€…å»ºè®®ï¼šå…·ä½“æ“ä½œæŒ‡å¼•\"\n      }\n    },\n    \"data_perspective\": {\n      \"trend_status\": {\n        \"ma_alignment\": \"å‡çº¿æ’åˆ—çŠ¶æ€æè¿°\",\n        \"is_bullish\": true/false,\n        \"trend_score\": 0-100\n      },\n      \"price_position\": {\n        \"current_price\": å½“å‰ä»·æ ¼,\n        \"ma5\": MA5æ•°å€¼,\n        \"bias_ma5\": ä¹–ç¦»ç‡,\n        \"bias_status\": \"å®‰å…¨/è­¦æˆ’/å±é™©\",\n        \"support_level\": æ”¯æ’‘ä½,\n        \"resistance_level\": å‹åŠ›ä½\n      },\n      \"volume_analysis\": {\n        \"volume_ratio\": é‡æ¯”,\n        \"volume_status\": \"æ”¾é‡/ç¼©é‡/å¹³é‡\",\n        \"volume_meaning\": \"é‡èƒ½å«ä¹‰è§£è¯»\"\n      }\n    },\n    \"intelligence\": {\n      \"latest_news\": \"è¿‘æœŸé‡è¦æ–°é—»æ‘˜è¦\",\n      \"risk_alerts\": [\"é£é™©ç‚¹1\", \"é£é™©ç‚¹2\"],\n      \"positive_catalysts\": [\"åˆ©å¥½1\", \"åˆ©å¥½2\"],\n      \"sentiment_summary\": \"èˆ†æƒ…æƒ…ç»ªä¸€å¥è¯æ€»ç»“\"\n    },\n    \"battle_plan\": {\n      \"sniper_points\": {\n        \"ideal_buy\": \"ç†æƒ³ä¹°å…¥ç‚¹ï¼šXXå…ƒ\",\n        \"secondary_buy\": \"æ¬¡ä¼˜ä¹°å…¥ç‚¹ï¼šXXå…ƒ\",\n        \"stop_loss\": \"æ­¢æŸä½ï¼šXXå…ƒ\",\n        \"take_profit\": \"ç›®æ ‡ä½ï¼šXXå…ƒ\"\n      },\n      \"checklist\": [\n        \"âœ… å¤šå¤´æ’åˆ—\",\n        \"âœ… ä¹–ç¦»ç‡<5%\",\n        \"âš ï¸ é‡èƒ½ä¸è¶³\",\n        \"âŒ é‡å¤§åˆ©ç©º\"\n      ],\n      \"position_strategy\": {\n        \"no_position\": \"ç©ºä»“è€…æ“ä½œæ–¹æ¡ˆ\",\n        \"has_position\": \"æŒä»“è€…æ“ä½œæ–¹æ¡ˆ\"\n      }\n    }\n  }\n}\n```\n\n## åˆ†æè¦æ±‚\n\n1. **ä¸¥æ ¼éµå¾ªäº¤æ˜“ç†å¿µ**ï¼šä¹–ç¦»ç‡>5%æ—¶ï¼Œæ— è®ºå…¶ä»–æŒ‡æ ‡å¤šå¥½ï¼Œéƒ½å¿…é¡»åˆ¤å®šä¸º\"è§‚æœ›\"\n2. **ç»™å‡ºå…·ä½“ä»·ä½**ï¼šå¿…é¡»æä¾›ä¹°å…¥ä»·ã€æ­¢æŸä»·ã€ç›®æ ‡ä»·\n3. **åŒºåˆ†æŒä»“å»ºè®®**ï¼šç©ºä»“è€…å’ŒæŒä»“è€…çš„å»ºè®®è¦ä¸åŒ\n4. **æ£€æŸ¥æ¸…å•**ï¼šç”¨âœ…/âš ï¸/âŒæ ‡è®°å„é¡¹æ¡ä»¶\n5. **é£é™©ä¼˜å…ˆ**ï¼šå®å¯é”™è¿‡ï¼Œä¸å¯åšé”™\n\n## ä¿¡å·åˆ¤å®šè§„åˆ™\n\n- ğŸŸ¢ **å¼ºçƒˆä¹°å…¥**ï¼šä¹–ç¦»ç‡<2% + å¤šå¤´æ’åˆ— + é‡æ¯”>1.2\n- ğŸŸ¢ **ä¹°å…¥**ï¼šä¹–ç¦»ç‡<5% + å¤šå¤´æ’åˆ—\n- ğŸŸ¡ **æŒæœ‰è§‚æœ›**ï¼šå·²æŒä»“ä¸”è¶‹åŠ¿æœªç ´å\n- ğŸ”´ **å–å‡º**ï¼šè·Œç ´æ­¢æŸä½æˆ–è¶‹åŠ¿åè½¬\n- âš ï¸ **é£é™©è­¦å‘Š**ï¼šä¹–ç¦»ç‡è¿‡é«˜æˆ–é‡å¤§åˆ©ç©º"
        }
      },
      "id": "ca533ec4-9726-47bb-84e5-8654759c3c03",
      "name": "AIåˆ†æAgent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        -1424,
        304
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// ã€ä¿®å¤ç‰ˆã€‘æ„å»ºAIæç¤ºè¯\n\n// 1. å…³é”®ä¿®æ”¹ï¼šæ˜ç¡®æŒ‡å®šå»â€œåˆå¹¶æŠ€æœ¯æŒ‡æ ‡â€èŠ‚ç‚¹æ‰¾å›ä¸¢å¤±çš„æŠ€æœ¯æ•°æ®\n// âš ï¸ å¦‚æœæŠ¥é”™ï¼Œè¯·ç¡®ä¿ä½ å‰é¢çš„èŠ‚ç‚¹åç§°ç¡®å®å« \"åˆå¹¶æŠ€æœ¯æŒ‡æ ‡\"\nconst technical = $('åˆå¹¶æŠ€æœ¯æŒ‡æ ‡').item.json;\n\n// 2. è·å–å½“å‰èŠ‚ç‚¹è¾“å…¥çš„æ–°é—»æ•°æ® (Tavilyçš„è¾“å‡º)\nconst news = $json;\n\n// 3. æ„å»ºæç¤ºè¯ (Prompt)\nconst prompt = `# å†³ç­–ä»ªè¡¨ç›˜åˆ†æè¯·æ±‚\n\n## è‚¡ç¥¨ä¿¡æ¯\n- ä»£ç ï¼š${technical.code}\n- åç§°ï¼š${technical.name || technical.code}\n- å¸‚åœºï¼š${technical.market === 'A' ? 'Aè‚¡' : 'æ¸¯è‚¡'}\n- æ—¥æœŸï¼š${new Date().toISOString().split('T')[0]}\n\n## æŠ€æœ¯é¢æ•°æ®\n\n### ä»·æ ¼ä¸å‡çº¿\n| æŒ‡æ ‡ | æ•°å€¼ |\n|------|------|\n| å½“å‰ä»·æ ¼ | ${technical.current_price} ${technical.currency || 'CNY'} |\n| MA5 | ${technical.ma5} |\n| MA10 | ${technical.ma10} |\n| MA20 | ${technical.ma20} |\n| MA60 | ${technical.ma60} |\n| ä¹–ç¦»ç‡(MA5) | ${technical.bias_ma5}% |\n| RSI(14) | ${technical.rsi14} |\n| é‡æ¯” | ${technical.volume_ratio} |\n\n### è¶‹åŠ¿åˆ¤æ–­\n- å‡çº¿å½¢æ€ï¼š${technical.ma_alignment}\n- è¶‹åŠ¿è¯„åˆ†ï¼š${technical.trend_score}/100\n- ç³»ç»Ÿä¿¡å·ï¼š${technical.signal}\n\n### å…³é”®ä»·ä½ (åŸºäºATRåŠ¨æ€é£æ§)\n- åŠ¨æ€æ­¢æŸä½ï¼š${technical.stop_loss} (åŸºäº2å€ATRæ³¢åŠ¨ç‡è®¡ç®—)\n- å»ºè®®ç›®æ ‡ä»·ï¼š${technical.take_profit} (1.5å€ç›ˆäºæ¯”)\n- å¸‚åœºæ³¢åŠ¨ç‡(ATR)ï¼š${technical.atr14}\n\n### ä¹°å…¥ç†ç”±\n${technical.signal_reasons?.join('\\n') || 'æ— '}\n\n### é£é™©å› ç´ \n${technical.risk_factors?.join('\\n') || 'æ— '}\n\n## æ–°é—»èˆ†æƒ…\n${news.answer || news.results ? `\næœç´¢ç»“æœï¼š\n${news.results?.map(r => `- ${r.title}: ${r.content?.substring(0, 100)}...`).join('\\n') || 'æ— è¯¦ç»†æ–°é—»'}\n\nAIæ‘˜è¦ï¼š${news.answer || 'æ— '}\n` : 'æœªæœç´¢åˆ°ç›¸å…³æ–°é—»'}\n\n## åˆ†æä»»åŠ¡\nè¯·åŸºäºä»¥ä¸Šæ•°æ®ç”Ÿæˆå†³ç­–ä»ªè¡¨ç›˜ã€‚\n**ç‰¹åˆ«æ³¨æ„ï¼š**\n1. **å°Šé‡åŠ¨æ€æ­¢æŸ**ï¼šè¯·ä¼˜å…ˆå‚è€ƒâ€œåŠ¨æ€æ­¢æŸä½â€ä½œä¸ºé£æ§çº¿ï¼Œè€Œéä»…ä»…çœ‹å›ºå®šæ¯”ä¾‹ã€‚\n2. **è¯†åˆ«èµ·çˆ†ç‚¹**ï¼šå¦‚æœ \\`signal\\` æ˜¾ç¤º \"å¼ºçƒˆä¹°å…¥ ğŸš€\"ï¼Œè¯´æ˜å‡ºç°äº†ã€å‡çº¿ç²˜åˆåçªç ´ã€‘ï¼Œæ­¤æ—¶å³ä½¿ä¹–ç¦»ç‡ç•¥é«˜ï¼ˆå¦‚3-4%ï¼‰ä¹Ÿæ˜¯å…è®¸çš„ï¼Œå› ä¸ºè¿™æ˜¯è¶‹åŠ¿çˆ†å‘åˆæœŸã€‚\n3. **èµ„é‡‘ç®¡ç†**ï¼šå¦‚æœ ATR æ•°å€¼å¾ˆå¤§ï¼Œè¯´æ˜è‚¡æ€§æ´»è·ƒï¼Œè¯·åœ¨å»ºè®®ä¸­æç¤ºâ€œæ§åˆ¶ä»“ä½ï¼Œé˜²èŒƒå‰§çƒˆæ³¢åŠ¨â€ã€‚\n\nå¿…é¡»ç»™å‡ºå…·ä½“çš„ä¹°å…¥ä»·ã€æ­¢æŸä»·ã€ç›®æ ‡ä»·ã€‚`;\n\n// å°†æ„é€ å¥½çš„ prompt å’ŒåŸå§‹æ•°æ®ä¸€èµ·ä¼ é€’ç»™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹\nreturn [{ \n    json: { \n        prompt: prompt, \n        technical: technical,\n        news_data: news\n    } \n}];"
      },
      "id": "5472adcc-3e38-4227-816f-10365d8b8ef2",
      "name": "æ„å»ºAIæç¤ºè¯",
      "type": "n8n-nodes-base.code",
      "position": [
        -1600,
        304
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "jsCode": "// ã€å…¨é€‰æ›¿æ¢ã€‘è§£æAIåˆ†æç»“æœ - ç»ˆæä¿®å¤ç‰ˆ\n// ä¿®å¤äº†æŠ€æœ¯æŒ‡æ ‡(ç°ä»·/RSIç­‰)åœ¨å†™å…¥è¡¨æ ¼æ—¶æ˜¾ç¤º undefined çš„é—®é¢˜\n\n// 1. è·å– AI çš„åˆ†æå›å¤\nconst aiOutput = $json.output || $json.content || $json.response || $json;\n\n// 2. ã€å…³é”®ä¿®å¤ã€‘å¼ºåˆ¶ä» \"æ„å»ºAIæç¤ºè¯\" èŠ‚ç‚¹æ‰¾å›åŸå§‹æŠ€æœ¯æ•°æ®\n// è¿™æ ·æ— è®º AI èŠ‚ç‚¹æ€ä¹ˆåæ•°æ®ï¼Œæˆ‘ä»¬éƒ½èƒ½æ‹¿åˆ°æœ€åŸå§‹çš„ RSIã€å‡çº¿ç­‰æŒ‡æ ‡\nlet technical;\ntry {\n  technical = $('æ„å»ºAIæç¤ºè¯').item.json.technical;\n} catch (e) {\n  technical = $json.technical || {}; // å¤‡é€‰æ–¹æ¡ˆ\n}\n\ntry {\n  // 3. æ¸…ç† AI å›å¤ä¸­çš„ Markdown æ ¼å¼ (å»æ‰ ```json )\n  let jsonStr = typeof aiOutput === 'string' ? aiOutput : JSON.stringify(aiOutput);\n  \n  if (jsonStr.includes('```json')) {\n    jsonStr = jsonStr.replace(/```json\\n?/g, '').replace(/```\\n?/g, '');\n  } else if (jsonStr.includes('```')) {\n    jsonStr = jsonStr.replace(/```\\n?/g, '');\n  }\n  \n  // æˆªå–çº¯ JSON éƒ¨åˆ†\n  const jsonStart = jsonStr.indexOf('{');\n  const jsonEnd = jsonStr.lastIndexOf('}') + 1;\n  if (jsonStart >= 0 && jsonEnd > jsonStart) {\n    jsonStr = jsonStr.substring(jsonStart, jsonEnd);\n  }\n  \n  // 4. è§£æ JSON\n  const data = JSON.parse(jsonStr);\n  const dashboard = data.dashboard || {};\n  \n  // 5. ç»„è£…æœ€ç»ˆæ•°æ® (æ··åˆäº† AI çš„è§‚ç‚¹å’ŒåŸå§‹æŠ€æœ¯æŒ‡æ ‡)\n  const result = {\n    date: new Date().toISOString().split('T')[0],\n    code: technical.code,\n    market: technical.market,\n    name: data.stock_name || technical.name || technical.code,\n    \n    // AI åˆ†æç»“è®º\n    signal_type: dashboard.core_conclusion?.signal_type || data.trend_prediction || 'è§‚æœ›',\n    sentiment_score: data.sentiment_score || 50,\n    operation_advice: data.operation_advice || 'è§‚æœ›',\n    decision_type: data.decision_type || 'hold',\n    one_sentence: dashboard.core_conclusion?.one_sentence || data.analysis_summary || '',\n    \n    // å…·ä½“å»ºè®®\n    advice_no_position: dashboard.core_conclusion?.position_advice?.no_position || '',\n    advice_has_position: dashboard.core_conclusion?.position_advice?.has_position || '',\n    \n    // ä»·æ ¼ç‚¹ä½ (ä¼˜å…ˆç”¨AIå»ºè®®çš„ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç”¨æŠ€æœ¯ä½å…œåº•)\n    entry_price: dashboard.battle_plan?.sniper_points?.ideal_buy || technical.support_level,\n    stop_loss: dashboard.battle_plan?.sniper_points?.stop_loss || technical.stop_loss,\n    take_profit: dashboard.battle_plan?.sniper_points?.take_profit || technical.resistance_level,\n    \n    // ã€ä¿®å¤ç‚¹ã€‘è¿™é‡Œç›´æ¥ä½¿ç”¨æ‰¾å›æ¥çš„ technical æ•°æ®\n    current_price: technical.current_price,\n    atr14: technical.atr14,\n    bias_ma5: technical.bias_ma5,\n    rsi14: technical.rsi14,\n    volume_ratio: technical.volume_ratio,\n    ma_alignment: technical.ma_alignment,\n    \n    // æ–‡æœ¬ç±»è¯¦æƒ…\n    checklist: dashboard.battle_plan?.checklist?.join('\\n') || '',\n    risk_alerts: dashboard.intelligence?.risk_alerts?.join('\\n') || '',\n    news_summary: dashboard.intelligence?.sentiment_summary || '',\n    \n    raw_analysis: data\n  };\n  \n  return [{ json: result }];\n  \n} catch (error) {\n  // å®¹é”™å¤„ç†ï¼šä¸‡ä¸€è§£æå¤±è´¥ï¼Œè‡³å°‘æŠŠæŠ€æœ¯æŒ‡æ ‡å†™è¿›å»ï¼Œåˆ«è®©è¡¨æ ¼ç©ºç€\n  return [{\n    json: {\n      date: new Date().toISOString().split('T')[0],\n      code: technical?.code || 'ERROR',\n      name: technical?.name,\n      signal_type: 'è§£æå¤±è´¥',\n      one_sentence: 'AIè¿”å›æ ¼å¼å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥åŸå§‹æ—¥å¿—',\n      current_price: technical?.current_price,\n      bias_ma5: technical?.bias_ma5,\n      error: error.message,\n      raw_output: aiOutput\n    }\n  }];\n}"
      },
      "id": "edd98ee1-6c2d-4faf-8964-ebacb5fdcd1",
      "name": "è§£æAIåˆ†æç»“æœ",
      "type": "n8n-nodes-base.code",
      "position": [
        -1136,
        304
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "condition-signal",
              "leftValue": "={{ $('è§£æAIåˆ†æç»“æœ').item.json['signal_type'] }}",
              "rightValue": "ä¹°å…¥",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "15bd997c-4584-4a3f-babd-7e64847955db",
      "name": "åˆ¤æ–­æ˜¯å¦ä¹°å…¥ä¿¡å·",
      "type": "n8n-nodes-base.if",
      "position": [
        -704,
        304
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ã€ä¸‡èƒ½é€‚é…ç‰ˆã€‘æ„å»ºé£ä¹¦å¡ç‰‡_ä¹°å…¥ (è‡ªåŠ¨ç©¿é€é£ä¹¦æ•°æ®ç»“æ„)\n\nconst root = $json || {};\n\n// 1. æ™ºèƒ½æå–æ•°æ®\nconst feishuFields = root.data?.records?.[0]?.fields || {};\n\nconst getVal = (keyCN, keyEN, defaultVal) => {\n  return feishuFields[keyCN] || root[keyCN] || root[keyEN] || defaultVal;\n};\n\n// 2. å˜é‡æå–\nconst signal = getVal('ä¿¡å·ç±»å‹', 'signal_type', \"å¼ºçƒˆä¹°å…¥\");\nconst score = getVal('ç»¼åˆè¯„åˆ†', 'sentiment_score', 0);\nconst advice = getVal('æ“ä½œå»ºè®®', 'operation_advice', \"å»ºè®®ä¹°å…¥\");\nconst summary = getVal('æ ¸å¿ƒç»“è®º', 'one_sentence', \"æ— è¯¦ç»†ç»“è®º\");\nconst stockName = getVal('åç§°', 'name', \"è‚¡ç¥¨\");\nconst code = getVal('ä»£ç ', 'code', \"\");\n\n// æ—¥æœŸå¤„ç†\nlet dateVal = getVal('æ—¥æœŸ', 'date', new Date());\nif (typeof dateVal === 'number') {\n  dateVal = new Date(dateVal).toISOString().split('T')[0];\n}\n\n// ä»·æ ¼ä¸æŒ‡æ ‡\nconst entryPrice = getVal('ä¹°å…¥ä»·', 'entry_price', \"æœªè®¾å®š\");\nconst stopLoss = getVal('æ­¢æŸä»·', 'stop_loss', \"æœªè®¾å®š\");\nconst takeProfit = getVal('ç›®æ ‡ä»·', 'take_profit', \"æœªè®¾å®š\");\nconst currentPrice = getVal('ç°ä»·', 'current_price', 0);\n\n// æ³¨æ„ï¼šé£ä¹¦è¿”å›çš„ä¹–ç¦»ç‡å·²ç»æ˜¯å¸¦%çš„å­—ç¬¦ä¸²ï¼Œæˆ–è€…æ•°å­—\nlet bias = getVal('ä¹–ç¦»ç‡', 'bias_ma5', \"0%\");\nif (typeof bias === 'number') bias = bias + \"%\";\n\nconst rsi = getVal('RSI', 'rsi14', 0);\nconst volRatio = getVal('é‡æ¯”', 'volume_ratio', 0);\nconst maAlign = getVal('å‡çº¿å½¢æ€', 'ma_alignment', \"å¤šå¤´æ’åˆ—\");\nconst checklist = getVal('æ£€æŸ¥æ¸…å•', 'checklist', \"æ— \");\nconst riskAlerts = getVal('é£é™©è­¦æŠ¥', 'risk_alerts', \"æ— \");\n\n// 3. é¢œè‰²\nconst getColor = () => 'green';\n\n// 4. æ„å»ºå†…å®¹\nconst cardContent = [\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `**${signal}** | è¯„åˆ†: **${score}**/100 | ${advice}`\n    }\n  },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `ğŸ’¡ **æ ¸å¿ƒç»“è®º**ï¼š${summary}`\n    }\n  },\n  {\n    tag: 'hr'\n  },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `ğŸ’° **ç‹™å‡»ç‚¹ä½**\\nâ€¢ ä¹°å…¥ä»·: **${entryPrice}**\\nâ€¢ æ­¢æŸä»·: ${stopLoss}\\nâ€¢ ç›®æ ‡ä»·: ${takeProfit}`\n    }\n  },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `ğŸ“ˆ **æŠ€æœ¯æŒ‡æ ‡**\\nâ€¢ ç°ä»·: ${currentPrice}\\nâ€¢ ä¹–ç¦»ç‡: ${bias}\\nâ€¢ RSI: ${rsi}\\nâ€¢ é‡æ¯”: ${volRatio}\\nâ€¢ å‡çº¿: ${maAlign}`\n    }\n  },\n  {\n    tag: 'hr'\n  },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `âœ… **æ£€æŸ¥æ¸…å•**\\n${checklist}`\n    }\n  },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `âš ï¸ **é£é™©è­¦æŠ¥**\\n${riskAlerts}`\n    }\n  },\n  // è·³è½¬æŒ‰é’®\n  {\n    tag: 'action',\n    actions: [\n      {\n        tag: 'button',\n        text: { tag: 'plain_text', content: 'ğŸ“Š æŸ¥çœ‹å®Œæ•´æ•°æ®è¡¨' },\n        type: 'primary',\n        url: 'https://xcnf59usubzt.feishu.cn/base/RVghbRvYgacqs3s82qkcl83bn7e?table=tblvrNDNrjAZwBZc'\n      }\n    ]\n  },\n  {\n    tag: 'note',\n    elements: [\n      {\n        tag: 'plain_text',\n        content: `ç”Ÿæˆæ—¶é—´: ${dateVal} | ä»…ä¾›å‚è€ƒ`\n      }\n    ]\n  }\n];\n\n// 5. è¾“å‡º\nreturn {\n  json: {\n    card_color: getColor(),\n    card_content: cardContent,\n    header_title: `ğŸ“Š ${stockName}(${code}) å†³ç­–ä»ªè¡¨ç›˜`\n  }\n};"
      },
      "id": "8acda449-9fd1-4f62-b9c7-3f7a765cb776",
      "name": "æ„å»ºé£ä¹¦å¡ç‰‡_ä¹°å…¥",
      "type": "n8n-nodes-base.code",
      "position": [
        -464,
        288
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ã€ä¸‡èƒ½é€‚é…ç‰ˆã€‘æ„å»ºé£ä¹¦å¡ç‰‡_å…¶ä»– (è‡ªåŠ¨ç©¿é€é£ä¹¦æ•°æ®ç»“æ„)\n\nconst root = $json || {};\n\n// 1. æ™ºèƒ½æå–æ•°æ® (æ ¸å¿ƒä¿®å¤)\n// ä¼˜å…ˆå°è¯•ä»é£ä¹¦ API çš„æ·±å±‚ç»“æ„ä¸­æå– fields\nconst feishuFields = root.data?.records?.[0]?.fields || {};\n\n// å®šä¹‰ä¸€ä¸ªå–å€¼å‡½æ•°ï¼šå…ˆæ‰¾é£ä¹¦ç»“æ„(ä¸­æ–‡)ï¼Œå†æ‰¾æ ¹ç›®å½•(ä¸­æ–‡)ï¼Œæœ€åæ‰¾æ ¹ç›®å½•(è‹±æ–‡)\nconst getVal = (keyCN, keyEN, defaultVal) => {\n  return feishuFields[keyCN] || root[keyCN] || root[keyEN] || defaultVal;\n};\n\n// 2. è·å–å˜é‡\nconst signal = getVal('ä¿¡å·ç±»å‹', 'signal_type', \"æ— ä¿¡å·\");\nconst score = getVal('ç»¼åˆè¯„åˆ†', 'sentiment_score', 0);\nconst advice = getVal('æ“ä½œå»ºè®®', 'operation_advice', \"æš‚æ— å»ºè®®\");\nconst summary = getVal('æ ¸å¿ƒç»“è®º', 'one_sentence', \"æ— è¯¦ç»†ç»“è®º\");\nconst stockName = getVal('åç§°', 'name', \"è‚¡ç¥¨\");\nconst code = getVal('ä»£ç ', 'code', \"\");\n\n// æ—¥æœŸå¤„ç†ï¼šé£ä¹¦è¿”å›çš„æ˜¯æ¯«ç§’æ—¶é—´æˆ³ï¼Œéœ€è¦è½¬å›å­—ç¬¦ä¸²\nlet dateVal = getVal('æ—¥æœŸ', 'date', new Date());\nif (typeof dateVal === 'number') {\n  // å¦‚æœæ˜¯æ—¶é—´æˆ³ (177...)ï¼Œè½¬ä¸º YYYY-MM-DD\n  dateVal = new Date(dateVal).toISOString().split('T')[0];\n}\n\n// 3. é¢œè‰²é€»è¾‘\nconst getColor = () => {\n  const sigStr = signal.toString();\n  if (sigStr.includes('ä¹°å…¥')) return 'green';\n  if (sigStr.includes('å–å‡º') || sigStr.includes('å‡ä»“')) return 'red';\n  return 'yellow'; \n};\n\n// 4. æ„å»ºå¡ç‰‡å†…å®¹\nconst cardContent = [\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `**${signal}** | è¯„åˆ†ï¼š**${score}** / 100\\n${advice}`\n    }\n  },\n  {\n    tag: 'hr'\n  },\n  {\n    tag: 'div',\n    text: {\n      tag: 'lark_md',\n      content: `ğŸ’¡ **ä¸€å¥è¯ç»“è®º**ï¼š\\n${summary}`\n    }\n  },\n  // è·³è½¬æŒ‰é’®\n  {\n    tag: 'action',\n    actions: [\n      {\n        tag: 'button',\n        text: { tag: 'plain_text', content: 'ğŸ“Š æŸ¥çœ‹å®Œæ•´æ•°æ®è¡¨' },\n        type: 'default',\n        // ä½ çš„å¤šç»´è¡¨æ ¼é“¾æ¥\n        url: 'https://xcnf59usubzt.feishu.cn/base/RVghbRvYgacqs3s82qkcl83bn7e?table=tblvrNDNrjAZwBZc'\n      }\n    ]\n  },\n  {\n    tag: 'note',\n    elements: [\n      {\n        tag: 'plain_text',\n        content: `ç”Ÿæˆæ—¶é—´: ${dateVal} | ${stockName}(${code})`\n      }\n    ]\n  }\n];\n\n// 5. è¾“å‡º\nreturn {\n  json: {\n    card_color: getColor(),\n    card_content: cardContent,\n    header_title: `${stockName} - æ¯æ—¥åˆ†æ`\n  }\n};\n"
      },
      "id": "cab9d3a9-3ec1-49b0-9369-f58c78066446",
      "name": "æ„å»ºé£ä¹¦å¡ç‰‡_å…¶ä»–",
      "type": "n8n-nodes-base.code",
      "position": [
        -464,
        496
      ],
      "typeVersion": 2
    },
    {
      "parameters": {},
      "id": "1fd4bede-91c0-4936-a81d-bfab29330ab7",
      "name": "åˆå¹¶æ¨é€ç»“æœ",
      "type": "n8n-nodes-base.merge",
      "position": [
        0,
        0
      ],
      "typeVersion": 2.1
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1424,
        512
      ],
      "id": "b42c70fd-f9c9-4489-8a28-a608b00fc790",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "V4cRtuj3j8gaQfEU",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "message:send",
        "receive_id_type": "user_id",
        "receive_id": "bg99a8dc",
        "msg_type": "interactive",
        "content": "={{\nJSON.stringify({\n  \"config\": {\n    \"wide_screen_mode\": true\n  },\n  \"header\": {\n    \"template\": $json.card_color,\n    \"title\": {\n      \"content\": $json.header_title,\n      \"tag\": \"plain_text\"\n    }\n  },\n  \"elements\": $json.card_content\n})\n}}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        -288,
        496
      ],
      "id": "b94e6026-3a24-4b43-910b-f98a2005f264",
      "name": "é£ä¹¦å‘é€æ¶ˆæ¯_å…¶ä»–",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "RcP0KB4O5l2Y95Bs",
          "name": "Feishu account 2"
        }
      }
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "message:send",
        "receive_id_type": "user_id",
        "receive_id": "bg99a8dc",
        "msg_type": "interactive",
        "content": "={{\nJSON.stringify({\n  \"config\": {\n    \"wide_screen_mode\": true\n  },\n  \"header\": {\n    \"template\": $json.card_color,\n    \"title\": {\n      \"content\": $json.header_title,\n      \"tag\": \"plain_text\"\n    }\n  },\n  \"elements\": $json.card_content\n})\n}}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        -288,
        288
      ],
      "id": "697476c6-5516-46b1-8db9-665c89d21cb5",
      "name": "é£ä¹¦å‘é€æ¶ˆæ¯_ä¹°å…¥",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "RcP0KB4O5l2Y95Bs",
          "name": "Feishu account 2"
        }
      }
    },
    {
      "parameters": {
        "resource": "bitable",
        "operation": "bitable:table:record:batchAdd",
        "app_toke": "RVghbRvYgacqs3s82qkcl83bn7e",
        "table_id": "tblvrNDNrjAZwBZc",
        "body": "={{\nJSON.stringify({\n  \"records\": [\n    {\n      \"fields\": {\n        \"æ—¥æœŸ\": new Date($json[\"date\"]).getTime(), // æ³¨æ„ï¼šAIèŠ‚ç‚¹è¾“å‡ºçš„æ˜¯ date (å°å†™è‹±æ–‡)\n        \"å¸‚åœº\": $json[\"market\"],\n        \"ä»£ç \": $json[\"code\"],\n        \"åç§°\": $json[\"name\"],\n        \"ä¿¡å·ç±»å‹\": $json[\"signal_type\"],\n        \"ç»¼åˆè¯„åˆ†\": Number($json[\"sentiment_score\"]),\n        \"æ“ä½œå»ºè®®\": $json[\"operation_advice\"],\n        \"æ ¸å¿ƒç»“è®º\": $json[\"one_sentence\"],\n        \"ä¹°å…¥ä»·\": $json[\"entry_price\"],\n        \"æ­¢æŸä»·\": $json[\"stop_loss\"],\n        \"ç›®æ ‡ä»·\": $json[\"take_profit\"],\n        \"ç°ä»·\": Number($json[\"current_price\"]),\n        \"ATR\": Number($json[\"atr14\"]),\n        \"ä¹–ç¦»ç‡\": $json[\"bias_ma5\"] + \"%\", // AIè¾“å‡ºå¯èƒ½æ˜¯çº¯æ•°å­—ï¼Œé£ä¹¦å¦‚æœæ˜¯æ–‡æœ¬åˆ—å¯èƒ½éœ€è¦åŠ  %ï¼Œå¦‚æœæ˜¯æ•°å­—åˆ—åˆ™ä¸ç”¨\n        \"RSI\": Number($json[\"rsi14\"]),\n        \"é‡æ¯”\": Number($json[\"volume_ratio\"]),\n        \"å‡çº¿å½¢æ€\": $json[\"ma_alignment\"],\n        \"æ£€æŸ¥æ¸…å•\": $json[\"checklist\"],\n        \"é£é™©è­¦æŠ¥\": $json[\"risk_alerts\"],\n        \"æ–°é—»æ‘˜è¦\": $json[\"news_summary\"],\n        \"ç©ºä»“å»ºè®®\": $json[\"advice_no_position\"],\n        \"æŒä»“å»ºè®®\": $json[\"advice_has_position\"]\n      }\n    }\n  ]\n})\n}}"
      },
      "type": "n8n-nodes-feishu-lite.feishuNode",
      "typeVersion": 1,
      "position": [
        -912,
        304
      ],
      "id": "fb37f644-6fac-4176-8210-315c7f8346f6",
      "name": "å†™å…¥é£ä¹¦",
      "credentials": {
        "feishuCredentialsApi": {
          "id": "RcP0KB4O5l2Y95Bs",
          "name": "Feishu account 2"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "å®šæ—¶è§¦å‘_å·¥ä½œæ—¥18ç‚¹": {
      "main": [
        [
          {
            "node": "è¯»å–è‚¡ç¥¨åˆ—è¡¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è¯»å–è‚¡ç¥¨åˆ—è¡¨": {
      "main": [
        [
          {
            "node": "å¾ªç¯å¤„ç†æ¯åªè‚¡ç¥¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å¾ªç¯å¤„ç†æ¯åªè‚¡ç¥¨": {
      "main": [
        [],
        [
          {
            "node": "åˆ¤æ–­å¸‚åœºç±»å‹",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ¤æ–­å¸‚åœºç±»å‹": {
      "main": [
        [
          {
            "node": "è…¾è®¯è´¢ç»_å®æ—¶è¡Œæƒ…",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "YahooFinance_æ¸¯è‚¡æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è…¾è®¯è´¢ç»_å®æ—¶è¡Œæƒ…": {
      "main": [
        [
          {
            "node": "è§£æè…¾è®¯æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "YahooFinance_æ¸¯è‚¡æ•°æ®": {
      "main": [
        [
          {
            "node": "è§£æYahooæ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æè…¾è®¯æ•°æ®": {
      "main": [
        [
          {
            "node": "è…¾è®¯è´¢ç»_Kçº¿æ•°æ®",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æYahooæ•°æ®": {
      "main": [
        [
          {
            "node": "è®¡ç®—æ¸¯è‚¡æŠ€æœ¯æŒ‡æ ‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è…¾è®¯è´¢ç»_Kçº¿æ•°æ®": {
      "main": [
        [
          {
            "node": "è®¡ç®—Aè‚¡æŠ€æœ¯æŒ‡æ ‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è®¡ç®—Aè‚¡æŠ€æœ¯æŒ‡æ ‡": {
      "main": [
        [
          {
            "node": "åˆå¹¶æŠ€æœ¯æŒ‡æ ‡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è®¡ç®—æ¸¯è‚¡æŠ€æœ¯æŒ‡æ ‡": {
      "main": [
        [
          {
            "node": "åˆå¹¶æŠ€æœ¯æŒ‡æ ‡",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "åˆå¹¶æŠ€æœ¯æŒ‡æ ‡": {
      "main": [
        [
          {
            "node": "Tavilyæ–°é—»æœç´¢",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Tavilyæ–°é—»æœç´¢": {
      "main": [
        [
          {
            "node": "æ„å»ºAIæç¤ºè¯",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ„å»ºAIæç¤ºè¯": {
      "main": [
        [
          {
            "node": "AIåˆ†æAgent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AIåˆ†æAgent": {
      "main": [
        [
          {
            "node": "è§£æAIåˆ†æç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "è§£æAIåˆ†æç»“æœ": {
      "main": [
        [
          {
            "node": "å†™å…¥é£ä¹¦",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆ¤æ–­æ˜¯å¦ä¹°å…¥ä¿¡å·": {
      "main": [
        [
          {
            "node": "æ„å»ºé£ä¹¦å¡ç‰‡_ä¹°å…¥",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "æ„å»ºé£ä¹¦å¡ç‰‡_å…¶ä»–",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "åˆå¹¶æ¨é€ç»“æœ": {
      "main": [
        [
          {
            "node": "å¾ªç¯å¤„ç†æ¯åªè‚¡ç¥¨",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ„å»ºé£ä¹¦å¡ç‰‡_ä¹°å…¥": {
      "main": [
        [
          {
            "node": "é£ä¹¦å‘é€æ¶ˆæ¯_ä¹°å…¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "æ„å»ºé£ä¹¦å¡ç‰‡_å…¶ä»–": {
      "main": [
        [
          {
            "node": "é£ä¹¦å‘é€æ¶ˆæ¯_å…¶ä»–",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AIåˆ†æAgent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "é£ä¹¦å‘é€æ¶ˆæ¯_å…¶ä»–": {
      "main": [
        [
          {
            "node": "åˆå¹¶æ¨é€ç»“æœ",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "é£ä¹¦å‘é€æ¶ˆæ¯_ä¹°å…¥": {
      "main": [
        [
          {
            "node": "åˆå¹¶æ¨é€ç»“æœ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "å†™å…¥é£ä¹¦": {
      "main": [
        [
          {
            "node": "åˆ¤æ–­æ˜¯å¦ä¹°å…¥ä¿¡å·",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3c43405b-aaf9-40a4-8016-a6dd5dda44ba",
  "meta": {
    "instanceId": "2f742d99bafc29685192c328e0fdaa64b8db6ce3b25050806eb96df939878538"
  },
  "id": "x3BnZddAbjXBconp",
  "tags": []
}