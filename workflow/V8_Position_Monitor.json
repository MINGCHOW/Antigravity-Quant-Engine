{
    "name": "V8.0 æŠ•åç›¯ç›˜å·¥ä½œæµ",
    "nodes": [
        {
            "parameters": {
                "rule": {
                    "interval": [
                        {
                            "field": "cronExpression",
                            "expression": "10 15 * * 1-5"
                        }
                    ]
                }
            },
            "id": "position-trigger",
            "name": "æ¯æ—¥15:10è§¦å‘ (å·¥ä½œæ—¥)",
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.2,
            "position": [
                200,
                300
            ]
        },
        {
            "parameters": {
                "operation": "search",
                "app_token": "={{ $env.FEISHU_APP_TOKEN }}",
                "table": "æŒä»“ç®¡ç†",
                "filter": {
                    "conjunction": "and",
                    "conditions": [
                        {
                            "field_name": "æŒä»“çŠ¶æ€",
                            "operator": "is",
                            "value": [
                                "æŒä»“"
                            ]
                        }
                    ]
                }
            },
            "id": "read-positions",
            "name": "è¯»å–é£ä¹¦ã€æŒä»“ç®¡ç†ã€‘",
            "type": "n8n-nodes-base.feishuBitable",
            "typeVersion": 1,
            "position": [
                420,
                300
            ],
            "credentials": {
                "feishuBitableApi": {
                    "id": "feishu-credentials",
                    "name": "Feishu Bitable"
                }
            }
        },
        {
            "parameters": {
                "jsCode": "// è½¬æ¢é£ä¹¦è®°å½•ä¸º API è¯·æ±‚æ ¼å¼\nconst items = $input.all();\nconst positions = items.map(item => ({\n  code: item.json.fields['ä»£ç '],\n  market: item.json.fields['å¸‚åœº'] || 'CN',\n  buy_price: parseFloat(item.json.fields['ä¹°å…¥ä»·']) || 0,\n  current_stop: parseFloat(item.json.fields['å½“å‰æ­¢æŸ']) || 0,\n  target_price: parseFloat(item.json.fields['ç›®æ ‡ä»·']) || 0,\n  record_id: item.json.record_id  // ç”¨äºåç»­æ›´æ–°\n}));\n\nreturn [{ json: { positions } }];"
            },
            "id": "transform-data",
            "name": "è½¬æ¢æ•°æ®æ ¼å¼",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
                640,
                300
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "={{ $env.AKSHARE_API_URL }}/check_positions",
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={{ JSON.stringify($json) }}",
                "options": {
                    "timeout": 120000
                }
            },
            "id": "check-positions-api",
            "name": "è°ƒç”¨ /check_positions",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                860,
                300
            ]
        },
        {
            "parameters": {
                "fieldToSplitOut": "positions",
                "options": {}
            },
            "id": "split-results",
            "name": "æ‹†åˆ†æ£€æŸ¥ç»“æœ",
            "type": "n8n-nodes-base.splitOut",
            "typeVersion": 1,
            "position": [
                1080,
                300
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict"
                    },
                    "conditions": [
                        {
                            "id": "stop-loss-check",
                            "leftValue": "={{ $json.action }}",
                            "rightValue": "SELL_STOP",
                            "operator": {
                                "type": "string",
                                "operation": "equals"
                            }
                        }
                    ],
                    "combinator": "or"
                },
                "options": {}
            },
            "id": "check-stop-loss",
            "name": "æ£€æŸ¥æ˜¯å¦æ­¢æŸ",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                1300,
                200
            ]
        },
        {
            "parameters": {
                "conditions": {
                    "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict"
                    },
                    "conditions": [
                        {
                            "id": "target-check",
                            "leftValue": "={{ $json.action }}",
                            "rightValue": "SELL_TARGET",
                            "operator": {
                                "type": "string",
                                "operation": "equals"
                            }
                        }
                    ],
                    "combinator": "or"
                },
                "options": {}
            },
            "id": "check-target",
            "name": "æ£€æŸ¥æ˜¯å¦æ­¢ç›ˆ",
            "type": "n8n-nodes-base.if",
            "typeVersion": 2,
            "position": [
                1300,
                400
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "={{ $env.FEISHU_WEBHOOK_URL }}",
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"msg_type\": \"interactive\",\n  \"card\": {\n    \"header\": {\n      \"title\": {\n        \"tag\": \"plain_text\",\n        \"content\": \"ğŸ”´ æ­¢æŸè­¦æŠ¥: {{ $json.code }}\"\n      },\n      \"template\": \"red\"\n    },\n    \"elements\": [\n      {\n        \"tag\": \"div\",\n        \"text\": {\n          \"tag\": \"lark_md\",\n          \"content\": \"**ç°ä»·**: {{ $json.current_price }}\\n**åŸå› **: {{ $json.reason }}\\n**æ”¶ç›Šç‡**: {{ $json.pnl_percent }}%\"\n        }\n      },\n      {\n        \"tag\": \"hr\"\n      },\n      {\n        \"tag\": \"div\",\n        \"text\": {\n          \"tag\": \"lark_md\",\n          \"content\": \"âš ï¸ **å»ºè®®ç«‹å³å–å‡ºæ­¢æŸ**\"\n        }\n      }\n    ]\n  }\n}",
                "options": {}
            },
            "id": "send-stop-alert",
            "name": "å‘é€æ­¢æŸè­¦æŠ¥",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                1520,
                100
            ]
        },
        {
            "parameters": {
                "method": "POST",
                "url": "={{ $env.FEISHU_WEBHOOK_URL }}",
                "sendBody": true,
                "specifyBody": "json",
                "jsonBody": "={\n  \"msg_type\": \"interactive\",\n  \"card\": {\n    \"header\": {\n      \"title\": {\n        \"tag\": \"plain_text\",\n        \"content\": \"ğŸŸ¢ æ­¢ç›ˆè¾¾æ ‡: {{ $json.code }}\"\n      },\n      \"template\": \"green\"\n    },\n    \"elements\": [\n      {\n        \"tag\": \"div\",\n        \"text\": {\n          \"tag\": \"lark_md\",\n          \"content\": \"**ç°ä»·**: {{ $json.current_price }}\\n**åŸå› **: {{ $json.reason }}\\n**æ”¶ç›Šç‡**: {{ $json.pnl_percent }}%\"\n        }\n      },\n      {\n        \"tag\": \"hr\"\n      },\n      {\n        \"tag\": \"div\",\n        \"text\": {\n          \"tag\": \"lark_md\",\n          \"content\": \"ğŸ¯ **æ­å–œè¾¾åˆ°ç›®æ ‡ä»·ï¼**\"\n        }\n      }\n    ]\n  }\n}",
                "options": {}
            },
            "id": "send-target-alert",
            "name": "å‘é€æ­¢ç›ˆé€šçŸ¥",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
                1520,
                400
            ]
        },
        {
            "parameters": {},
            "id": "hold-no-action",
            "name": "ç»§ç»­æŒæœ‰ - å¯é€‰æ›´æ–°æ­¢æŸ",
            "type": "n8n-nodes-base.noOp",
            "typeVersion": 1,
            "position": [
                1520,
                600
            ]
        }
    ],
    "connections": {
        "æ¯æ—¥15:10è§¦å‘ (å·¥ä½œæ—¥)": {
            "main": [
                [
                    {
                        "node": "è¯»å–é£ä¹¦ã€æŒä»“ç®¡ç†ã€‘",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "è¯»å–é£ä¹¦ã€æŒä»“ç®¡ç†ã€‘": {
            "main": [
                [
                    {
                        "node": "è½¬æ¢æ•°æ®æ ¼å¼",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "è½¬æ¢æ•°æ®æ ¼å¼": {
            "main": [
                [
                    {
                        "node": "è°ƒç”¨ /check_positions",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "è°ƒç”¨ /check_positions": {
            "main": [
                [
                    {
                        "node": "æ‹†åˆ†æ£€æŸ¥ç»“æœ",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "æ‹†åˆ†æ£€æŸ¥ç»“æœ": {
            "main": [
                [
                    {
                        "node": "æ£€æŸ¥æ˜¯å¦æ­¢æŸ",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "æ£€æŸ¥æ˜¯å¦æ­¢ç›ˆ",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "æ£€æŸ¥æ˜¯å¦æ­¢æŸ": {
            "main": [
                [
                    {
                        "node": "å‘é€æ­¢æŸè­¦æŠ¥",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "ç»§ç»­æŒæœ‰ - å¯é€‰æ›´æ–°æ­¢æŸ",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "æ£€æŸ¥æ˜¯å¦æ­¢ç›ˆ": {
            "main": [
                [
                    {
                        "node": "å‘é€æ­¢ç›ˆé€šçŸ¥",
                        "type": "main",
                        "index": 0
                    }
                ],
                [
                    {
                        "node": "ç»§ç»­æŒæœ‰ - å¯é€‰æ›´æ–°æ­¢æŸ",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
        "templateCredsSetupCompleted": true
    },
    "pinData": {},
    "versionId": "v8.0-position-monitor-v1",
    "triggerCount": 0,
    "tags": []
}